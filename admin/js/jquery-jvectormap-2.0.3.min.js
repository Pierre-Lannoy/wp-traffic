!function(a){var b={set:{colors:1,values:1,backgroundColor:1,scaleColors:1,normalizeFunction:1,focus:1},get:{selectedRegions:1,selectedMarkers:1,mapObject:1,regionName:1}};a.fn.vectorMap=function(d){var e,c,e=this.children(".jvectormap-container").data("mapObject");if("addMap"===d){jvm.Map.maps[arguments[1]]=arguments[2]}else{if(("set"===d||"get"===d)&&b[d][arguments[1]]){return c=arguments[1].charAt(0).toUpperCase()+arguments[1].substr(1),e[d+c].apply(e,Array.prototype.slice.call(arguments,2))}d=d||{},d.container=this,e=new jvm.Map(d)}return this}}(jQuery),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(d){function l(i){var n=i||window.event,r=h.call(arguments,1),t=0,p=0,o=0,q=0;if(i=d.event.fix(n),i.type="mousewheel","detail" in n&&(o=-1*n.detail),"wheelDelta" in n&&(o=n.wheelDelta),"wheelDeltaY" in n&&(o=n.wheelDeltaY),"wheelDeltaX" in n&&(p=-1*n.wheelDeltaX),"axis" in n&&n.axis===n.HORIZONTAL_AXIS&&(p=-1*o,o=0),t=0===o?p:o,"deltaY" in n&&(o=-1*n.deltaY,t=o),"deltaX" in n&&(p=n.deltaX,0===o&&(t=-1*p)),0!==o||0!==p){if(1===n.deltaMode){var s=d.data(this,"mousewheel-line-height");t*=s,o*=s,p*=s}else{if(2===n.deltaMode){var m=d.data(this,"mousewheel-page-height");t*=m,o*=m,p*=m}}return q=Math.max(Math.abs(o),Math.abs(p)),(!b||b>q)&&(b=q,a(n,q)&&(b/=40)),a(n,q)&&(t/=40,p/=40,o/=40),t=Math[t>=1?"floor":"ceil"](t/b),p=Math[p>=1?"floor":"ceil"](p/b),o=Math[o>=1?"floor":"ceil"](o/b),i.deltaX=p,i.deltaY=o,i.deltaFactor=b,i.deltaMode=0,r.unshift(i,t,p,o),j&&clearTimeout(j),j=setTimeout(g,200),(d.event.dispatch||d.event.handle).apply(this,r)}}function g(){b=null}function a(m,i){return f.settings.adjustOldDeltas&&"mousewheel"===m.type&&i%120===0}var j,b,e=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],k="onwheel" in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],h=Array.prototype.slice;if(d.event.fixHooks){for(var c=e.length;c;){d.event.fixHooks[e[--c]]=d.event.mouseHooks}}var f=d.event.special.mousewheel={version:"3.1.9",setup:function(){if(this.addEventListener){for(var m=k.length;m;){this.addEventListener(k[--m],l,!1)}}else{this.onmousewheel=l}d.data(this,"mousewheel-line-height",f.getLineHeight(this)),d.data(this,"mousewheel-page-height",f.getPageHeight(this))},teardown:function(){if(this.removeEventListener){for(var m=k.length;m;){this.removeEventListener(k[--m],l,!1)}}else{this.onmousewheel=null}},getLineHeight:function(i){return parseInt(d(i)["offsetParent" in d.fn?"offsetParent":"parent"]().css("fontSize"),10)},getPageHeight:function(i){return d(i).height()},settings:{adjustOldDeltas:!0}};d.fn.extend({mousewheel:function(i){return i?this.bind("mousewheel",i):this.trigger("mousewheel")},unmousewheel:function(i){return this.unbind("mousewheel",i)}})});var jvm={inherits:function(c,b){function a(){}a.prototype=b.prototype,c.prototype=new a,c.prototype.constructor=c,c.parentClass=b},mixin:function(b,a){var c;for(c in a.prototype){a.prototype.hasOwnProperty(c)&&(b.prototype[c]=a.prototype[c])}},min:function(a){var c,b=Number.MAX_VALUE;if(a instanceof Array){for(c=0;c<a.length;c++){a[c]<b&&(b=a[c])}}else{for(c in a){a[c]<b&&(b=a[c])}}return b},max:function(b){var c,a=Number.MIN_VALUE;if(b instanceof Array){for(c=0;c<b.length;c++){b[c]>a&&(a=b[c])}}else{for(c in b){b[c]>a&&(a=b[c])}}return a},keys:function(a){var b,c=[];for(b in a){c.push(b)}return c},values:function(b){var d,c,a=[];for(c=0;c<arguments.length;c++){b=arguments[c];for(d in b){a.push(b[d])}}return a},whenImageLoaded:function(c){var b=new jvm.$.Deferred,a=jvm.$("<img/>");return a.error(function(){b.reject()}).load(function(){b.resolve(a)}),a.attr("src",c),b},isImageUrl:function(a){return/\.\w{3,4}$/.test(a)}};jvm.$=jQuery,Array.prototype.indexOf||(Array.prototype.indexOf=function(c,d){var b;if(null==this){throw new TypeError('"this" is null or not defined')}var e=Object(this),a=e.length>>>0;if(0===a){return -1}var f=+d||0;if(1/0===Math.abs(f)&&(f=0),f>=a){return -1}for(b=Math.max(f>=0?f:a-Math.abs(f),0);a>b;){if(b in e&&e[b]===c){return b}b++}return -1}),jvm.AbstractElement=function(b,a){this.node=this.createElement(b),this.name=b,this.properties={},a&&this.set(a)},jvm.AbstractElement.prototype.set=function(c,b){var a;if("object"==typeof c){for(a in c){this.properties[a]=c[a],this.applyAttr(a,c[a])}}else{this.properties[c]=b,this.applyAttr(c,b)}},jvm.AbstractElement.prototype.get=function(a){return this.properties[a]},jvm.AbstractElement.prototype.applyAttr=function(b,a){this.node.setAttribute(b,a)},jvm.AbstractElement.prototype.remove=function(){jvm.$(this.node).remove()},jvm.AbstractCanvasElement=function(b,c,a){this.container=b,this.setSize(c,a),this.rootElement=new jvm[this.classPrefix+"GroupElement"],this.node.appendChild(this.rootElement.node),this.container.appendChild(this.node)},jvm.AbstractCanvasElement.prototype.add=function(a,b){b=b||this.rootElement,b.add(a),a.canvas=this},jvm.AbstractCanvasElement.prototype.addPath=function(a,c,d){var b=new jvm[this.classPrefix+"PathElement"](a,c);return this.add(b,d),b},jvm.AbstractCanvasElement.prototype.addCircle=function(a,c,d){var b=new jvm[this.classPrefix+"CircleElement"](a,c);return this.add(b,d),b},jvm.AbstractCanvasElement.prototype.addImage=function(a,c,d){var b=new jvm[this.classPrefix+"ImageElement"](a,c);return this.add(b,d),b},jvm.AbstractCanvasElement.prototype.addText=function(a,c,d){var b=new jvm[this.classPrefix+"TextElement"](a,c);return this.add(b,d),b},jvm.AbstractCanvasElement.prototype.addGroup=function(b){var a=new jvm[this.classPrefix+"GroupElement"];return b?b.node.appendChild(a.node):this.node.appendChild(a.node),a.canvas=this,a},jvm.AbstractShapeElement=function(b,a,c){this.style=c||{},this.style.current=this.style.current||{},this.isHovered=!1,this.isSelected=!1,this.updateStyle()},jvm.AbstractShapeElement.prototype.setStyle=function(c,b){var a={};"object"==typeof c?a=c:a[c]=b,jvm.$.extend(this.style.current,a),this.updateStyle()},jvm.AbstractShapeElement.prototype.updateStyle=function(){var a={};jvm.AbstractShapeElement.mergeStyles(a,this.style.initial),jvm.AbstractShapeElement.mergeStyles(a,this.style.current),this.isHovered&&jvm.AbstractShapeElement.mergeStyles(a,this.style.hover),this.isSelected&&(jvm.AbstractShapeElement.mergeStyles(a,this.style.selected),this.isHovered&&jvm.AbstractShapeElement.mergeStyles(a,this.style.selectedHover)),this.set(a)},jvm.AbstractShapeElement.mergeStyles=function(b,c){var a;c=c||{};for(a in c){null===c[a]?delete b[a]:b[a]=c[a]}},jvm.SVGElement=function(){jvm.SVGElement.parentClass.apply(this,arguments)},jvm.inherits(jvm.SVGElement,jvm.AbstractElement),jvm.SVGElement.svgns="http://www.w3.org/2000/svg",jvm.SVGElement.prototype.createElement=function(a){return document.createElementNS(jvm.SVGElement.svgns,a)},jvm.SVGElement.prototype.addClass=function(a){this.node.setAttribute("class",a)},jvm.SVGElement.prototype.getElementCtr=function(a){return jvm["SVG"+a]},jvm.SVGElement.prototype.getBBox=function(){return this.node.getBBox()},jvm.SVGGroupElement=function(){jvm.SVGGroupElement.parentClass.call(this,"g")},jvm.inherits(jvm.SVGGroupElement,jvm.SVGElement),jvm.SVGGroupElement.prototype.add=function(a){this.node.appendChild(a.node)},jvm.SVGCanvasElement=function(){this.classPrefix="SVG",jvm.SVGCanvasElement.parentClass.call(this,"svg"),this.defsElement=new jvm.SVGElement("defs"),this.node.appendChild(this.defsElement.node),jvm.AbstractCanvasElement.apply(this,arguments)},jvm.inherits(jvm.SVGCanvasElement,jvm.SVGElement),jvm.mixin(jvm.SVGCanvasElement,jvm.AbstractCanvasElement),jvm.SVGCanvasElement.prototype.setSize=function(b,a){this.width=b,this.height=a,this.node.setAttribute("width",b),this.node.setAttribute("height",a)},jvm.SVGCanvasElement.prototype.applyTransformParams=function(c,b,a){this.scale=c,this.transX=b,this.transY=a,this.rootElement.node.setAttribute("transform","scale("+c+") translate("+b+", "+a+")")},jvm.SVGShapeElement=function(b,a){jvm.SVGShapeElement.parentClass.call(this,b,a),jvm.AbstractShapeElement.apply(this,arguments)},jvm.inherits(jvm.SVGShapeElement,jvm.SVGElement),jvm.mixin(jvm.SVGShapeElement,jvm.AbstractShapeElement),jvm.SVGShapeElement.prototype.applyAttr=function(a,c){var d,e,b=this;"fill"===a&&jvm.isImageUrl(c)?jvm.SVGShapeElement.images[c]?this.applyAttr("fill","url(#image"+jvm.SVGShapeElement.images[c]+")"):jvm.whenImageLoaded(c).then(function(f){e=new jvm.SVGElement("image"),e.node.setAttributeNS("http://www.w3.org/1999/xlink","href",c),e.applyAttr("x","0"),e.applyAttr("y","0"),e.applyAttr("width",f[0].width),e.applyAttr("height",f[0].height),d=new jvm.SVGElement("pattern"),d.applyAttr("id","image"+jvm.SVGShapeElement.imageCounter),d.applyAttr("x",0),d.applyAttr("y",0),d.applyAttr("width",f[0].width/2),d.applyAttr("height",f[0].height/2),d.applyAttr("viewBox","0 0 "+f[0].width+" "+f[0].height),d.applyAttr("patternUnits","userSpaceOnUse"),d.node.appendChild(e.node),b.canvas.defsElement.node.appendChild(d.node),jvm.SVGShapeElement.images[c]=jvm.SVGShapeElement.imageCounter++,b.applyAttr("fill","url(#image"+jvm.SVGShapeElement.images[c]+")")}):jvm.SVGShapeElement.parentClass.prototype.applyAttr.apply(this,arguments)},jvm.SVGShapeElement.imageCounter=1,jvm.SVGShapeElement.images={},jvm.SVGPathElement=function(a,b){jvm.SVGPathElement.parentClass.call(this,"path",a,b),this.node.setAttribute("fill-rule","evenodd")},jvm.inherits(jvm.SVGPathElement,jvm.SVGShapeElement),jvm.SVGCircleElement=function(a,b){jvm.SVGCircleElement.parentClass.call(this,"circle",a,b)},jvm.inherits(jvm.SVGCircleElement,jvm.SVGShapeElement),jvm.SVGImageElement=function(a,b){jvm.SVGImageElement.parentClass.call(this,"image",a,b)},jvm.inherits(jvm.SVGImageElement,jvm.SVGShapeElement),jvm.SVGImageElement.prototype.applyAttr=function(a,c){var b=this;"image"==a?jvm.whenImageLoaded(c).then(function(d){b.node.setAttributeNS("http://www.w3.org/1999/xlink","href",c),b.width=d[0].width,b.height=d[0].height,b.applyAttr("width",b.width),b.applyAttr("height",b.height),b.applyAttr("x",b.cx-b.width/2),b.applyAttr("y",b.cy-b.height/2),jvm.$(b.node).trigger("imageloaded",[d])}):"cx"==a?(this.cx=c,this.width&&this.applyAttr("x",c-this.width/2)):"cy"==a?(this.cy=c,this.height&&this.applyAttr("y",c-this.height/2)):jvm.SVGImageElement.parentClass.prototype.applyAttr.apply(this,arguments)},jvm.SVGTextElement=function(a,b){jvm.SVGTextElement.parentClass.call(this,"text",a,b)},jvm.inherits(jvm.SVGTextElement,jvm.SVGShapeElement),jvm.SVGTextElement.prototype.applyAttr=function(a,b){"text"===a?this.node.textContent=b:jvm.SVGTextElement.parentClass.prototype.applyAttr.apply(this,arguments)},jvm.VMLElement=function(){jvm.VMLElement.VMLInitialized||jvm.VMLElement.initializeVML(),jvm.VMLElement.parentClass.apply(this,arguments)},jvm.inherits(jvm.VMLElement,jvm.AbstractElement),jvm.VMLElement.VMLInitialized=!1,jvm.VMLElement.initializeVML=function(){try{document.namespaces.rvml||document.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),jvm.VMLElement.prototype.createElement=function(b){return document.createElement("<rvml:"+b+' class="rvml">')}}catch(a){jvm.VMLElement.prototype.createElement=function(b){return document.createElement("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}document.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)"),jvm.VMLElement.VMLInitialized=!0},jvm.VMLElement.prototype.getElementCtr=function(a){return jvm["VML"+a]},jvm.VMLElement.prototype.addClass=function(a){jvm.$(this.node).addClass(a)},jvm.VMLElement.prototype.applyAttr=function(a,b){this.node[a]=b},jvm.VMLElement.prototype.getBBox=function(){var a=jvm.$(this.node);return{x:a.position().left/this.canvas.scale,y:a.position().top/this.canvas.scale,width:a.width()/this.canvas.scale,height:a.height()/this.canvas.scale}},jvm.VMLGroupElement=function(){jvm.VMLGroupElement.parentClass.call(this,"group"),this.node.style.left="0px",this.node.style.top="0px",this.node.coordorigin="0 0"},jvm.inherits(jvm.VMLGroupElement,jvm.VMLElement),jvm.VMLGroupElement.prototype.add=function(a){this.node.appendChild(a.node)},jvm.VMLCanvasElement=function(){this.classPrefix="VML",jvm.VMLCanvasElement.parentClass.call(this,"group"),jvm.AbstractCanvasElement.apply(this,arguments),this.node.style.position="absolute"},jvm.inherits(jvm.VMLCanvasElement,jvm.VMLElement),jvm.mixin(jvm.VMLCanvasElement,jvm.AbstractCanvasElement),jvm.VMLCanvasElement.prototype.setSize=function(e,b){var f,a,d,c;if(this.width=e,this.height=b,this.node.style.width=e+"px",this.node.style.height=b+"px",this.node.coordsize=e+" "+b,this.node.coordorigin="0 0",this.rootElement){for(f=this.rootElement.node.getElementsByTagName("shape"),d=0,c=f.length;c>d;d++){f[d].coordsize=e+" "+b,f[d].style.width=e+"px",f[d].style.height=b+"px"}for(a=this.node.getElementsByTagName("group"),d=0,c=a.length;c>d;d++){a[d].coordsize=e+" "+b,a[d].style.width=e+"px",a[d].style.height=b+"px"}}},jvm.VMLCanvasElement.prototype.applyTransformParams=function(c,b,a){this.scale=c,this.transX=b,this.transY=a,this.rootElement.node.coordorigin=this.width-b-this.width/100+","+(this.height-a-this.height/100),this.rootElement.node.coordsize=this.width/c+","+this.height/c},jvm.VMLShapeElement=function(b,a){jvm.VMLShapeElement.parentClass.call(this,b,a),this.fillElement=new jvm.VMLElement("fill"),this.strokeElement=new jvm.VMLElement("stroke"),this.node.appendChild(this.fillElement.node),this.node.appendChild(this.strokeElement.node),this.node.stroked=!1,jvm.AbstractShapeElement.apply(this,arguments)},jvm.inherits(jvm.VMLShapeElement,jvm.VMLElement),jvm.mixin(jvm.VMLShapeElement,jvm.AbstractShapeElement),jvm.VMLShapeElement.prototype.applyAttr=function(a,b){switch(a){case"fill":this.node.fillcolor=b;break;case"fill-opacity":this.fillElement.node.opacity=Math.round(100*b)+"%";break;case"stroke":this.node.stroked="none"===b?!1:!0,this.node.strokecolor=b;break;case"stroke-opacity":this.strokeElement.node.opacity=Math.round(100*b)+"%";break;case"stroke-width":this.node.stroked=0===parseInt(b,10)?!1:!0,this.node.strokeweight=b;break;case"d":this.node.path=jvm.VMLPathElement.pathSvgToVml(b);break;default:jvm.VMLShapeElement.parentClass.prototype.applyAttr.apply(this,arguments)}},jvm.VMLPathElement=function(a,b){var c=new jvm.VMLElement("skew");jvm.VMLPathElement.parentClass.call(this,"shape",a,b),this.node.coordorigin="0 0",c.node.on=!0,c.node.matrix="0.01,0,0,0.01,0,0",c.node.offset="0,0",this.node.appendChild(c.node)},jvm.inherits(jvm.VMLPathElement,jvm.VMLShapeElement),jvm.VMLPathElement.prototype.applyAttr=function(a,b){"d"===a?this.node.path=jvm.VMLPathElement.pathSvgToVml(b):jvm.VMLShapeElement.prototype.applyAttr.call(this,a,b)},jvm.VMLPathElement.pathSvgToVml=function(d){var c,b,a=0,e=0;return d=d.replace(/(-?\d+)e(-?\d+)/g,"0"),d.replace(/([MmLlHhVvCcSs])\s*((?:-?\d*(?:\.\d+)?\s*,?\s*)+)/g,function(j,h,k){k=k.replace(/(\d)-/g,"$1,-").replace(/^\s+/g,"").replace(/\s+$/g,"").replace(/\s+/g,",").split(","),k[0]||k.shift();for(var g=0,f=k.length;f>g;g++){k[g]=Math.round(100*k[g])}switch(h){case"m":return a+=k[0],e+=k[1],"t"+k.join(",");case"M":return a=k[0],e=k[1],"m"+k.join(",");case"l":return a+=k[0],e+=k[1],"r"+k.join(",");case"L":return a=k[0],e=k[1],"l"+k.join(",");case"h":return a+=k[0],"r"+k[0]+",0";case"H":return a=k[0],"l"+a+","+e;case"v":return e+=k[0],"r0,"+k[0];case"V":return e=k[0],"l"+a+","+e;case"c":return c=a+k[k.length-4],b=e+k[k.length-3],a+=k[k.length-2],e+=k[k.length-1],"v"+k.join(",");case"C":return c=k[k.length-4],b=k[k.length-3],a=k[k.length-2],e=k[k.length-1],"c"+k.join(",");case"s":return k.unshift(e-b),k.unshift(a-c),c=a+k[k.length-4],b=e+k[k.length-3],a+=k[k.length-2],e+=k[k.length-1],"v"+k.join(",");case"S":return k.unshift(e+e-b),k.unshift(a+a-c),c=k[k.length-4],b=k[k.length-3],a=k[k.length-2],e=k[k.length-1],"c"+k.join(",")}return""}).replace(/z/g,"e")},jvm.VMLCircleElement=function(a,b){jvm.VMLCircleElement.parentClass.call(this,"oval",a,b)},jvm.inherits(jvm.VMLCircleElement,jvm.VMLShapeElement),jvm.VMLCircleElement.prototype.applyAttr=function(a,b){switch(a){case"r":this.node.style.width=2*b+"px",this.node.style.height=2*b+"px",this.applyAttr("cx",this.get("cx")||0),this.applyAttr("cy",this.get("cy")||0);break;case"cx":if(!b){return}this.node.style.left=b-(this.get("r")||0)+"px";break;case"cy":if(!b){return}this.node.style.top=b-(this.get("r")||0)+"px";break;default:jvm.VMLCircleElement.parentClass.prototype.applyAttr.call(this,a,b)}},jvm.VectorCanvas=function(b,c,a){return this.mode=window.SVGAngle?"svg":"vml",this.impl="svg"==this.mode?new jvm.SVGCanvasElement(b,c,a):new jvm.VMLCanvasElement(b,c,a),this.impl.mode=this.mode,this.impl},jvm.SimpleScale=function(a){this.scale=a},jvm.SimpleScale.prototype.getValue=function(a){return a},jvm.OrdinalScale=function(a){this.scale=a},jvm.OrdinalScale.prototype.getValue=function(a){return this.scale[a]},jvm.OrdinalScale.prototype.getTicks=function(){var a,b=[];for(a in this.scale){b.push({label:a,value:this.scale[a]})}return b},jvm.NumericScale=function(d,a,b,c){this.scale=[],a=a||"linear",d&&this.setScale(d),a&&this.setNormalizeFunction(a),"undefined"!=typeof b&&this.setMin(b),"undefined"!=typeof c&&this.setMax(c)},jvm.NumericScale.prototype={setMin:function(a){this.clearMinValue=a,this.minValue="function"==typeof this.normalize?this.normalize(a):a},setMax:function(a){this.clearMaxValue=a,this.maxValue="function"==typeof this.normalize?this.normalize(a):a},setScale:function(b){var a;for(this.scale=[],a=0;a<b.length;a++){this.scale[a]=[b[a]]}},setNormalizeFunction:function(a){"polynomial"===a?this.normalize=function(b){return Math.pow(b,0.2)}:"linear"===a?delete this.normalize:this.normalize=a,this.setMin(this.clearMinValue),this.setMax(this.clearMaxValue)},getValue:function(d){var a,g,f=[],e=0,b=0;for("function"==typeof this.normalize&&(d=this.normalize(d)),b=0;b<this.scale.length-1;b++){a=this.vectorLength(this.vectorSubtract(this.scale[b+1],this.scale[b])),f.push(a),e+=a}for(g=(this.maxValue-this.minValue)/e,b=0;b<f.length;b++){f[b]*=g}for(b=0,d-=this.minValue;d-f[b]>=0;){d-=f[b],b++}return d=this.vectorToNum(b==this.scale.length-1?this.scale[b]:this.vectorAdd(this.scale[b],this.vectorMult(this.vectorSubtract(this.scale[b+1],this.scale[b]),d/f[b])))},vectorToNum:function(a){var c,b=0;for(c=0;c<a.length;c++){b+=Math.round(a[c])*Math.pow(256,a.length-c-1)}return b},vectorSubtract:function(d,c){var b,a=[];for(b=0;b<d.length;b++){a[b]=d[b]-c[b]}return a},vectorAdd:function(d,c){var b,a=[];for(b=0;b<d.length;b++){a[b]=d[b]+c[b]}return a},vectorMult:function(b,c){var d,a=[];for(d=0;d<b.length;d++){a[d]=b[d]*c}return a},vectorLength:function(b){var c,a=0;for(c=0;c<b.length;c++){a+=b[c]*b[c]}return Math.sqrt(a)},getTicks:function(){var c,b,a=5,e=[this.clearMinValue,this.clearMaxValue],d=e[1]-e[0],h=Math.pow(10,Math.floor(Math.log(d/a)/Math.LN10)),g=a/d*h,f=[];for(0.15>=g?h*=10:0.35>=g?h*=5:0.75>=g&&(h*=2),e[0]=Math.floor(e[0]/h)*h,e[1]=Math.ceil(e[1]/h)*h,c=e[0];c<=e[1];){b=c==e[0]?this.clearMinValue:c==e[1]?this.clearMaxValue:c,f.push({label:c,value:this.getValue(b)}),c+=h}return f}},jvm.ColorScale=function(){jvm.ColorScale.parentClass.apply(this,arguments)},jvm.inherits(jvm.ColorScale,jvm.NumericScale),jvm.ColorScale.prototype.setScale=function(b){var a;for(a=0;a<b.length;a++){this.scale[a]=jvm.ColorScale.rgbToArray(b[a])}},jvm.ColorScale.prototype.getValue=function(a){return jvm.ColorScale.numToRgb(jvm.ColorScale.parentClass.prototype.getValue.call(this,a))},jvm.ColorScale.arrayToRgb=function(a){var e,c,b="#";for(c=0;c<a.length;c++){e=a[c].toString(16),b+=1==e.length?"0"+e:e}return b},jvm.ColorScale.numToRgb=function(a){for(a=a.toString(16);a.length<6;){a="0"+a}return"#"+a},jvm.ColorScale.rgbToArray=function(a){return a=a.substr(1),[parseInt(a.substr(0,2),16),parseInt(a.substr(2,2),16),parseInt(a.substr(4,2),16)]},jvm.Legend=function(a){this.params=a||{},this.map=this.params.map,this.series=this.params.series,this.body=jvm.$("<div/>"),this.body.addClass("jvectormap-legend"),this.params.cssClass&&this.body.addClass(this.params.cssClass),a.vertical?this.map.legendCntVertical.append(this.body):this.map.legendCntHorizontal.append(this.body),this.render()},jvm.Legend.prototype.render=function(){var d,c,f,b,e=this.series.scale.getTicks(),a=jvm.$("<div/>").addClass("jvectormap-legend-inner");for(this.body.html(""),this.params.title&&this.body.append(jvm.$("<div/>").addClass("jvectormap-legend-title").html(this.params.title)),this.body.append(a),d=0;d<e.length;d++){switch(c=jvm.$("<div/>").addClass("jvectormap-legend-tick"),f=jvm.$("<div/>").addClass("jvectormap-legend-tick-sample"),this.series.params.attribute){case"fill":jvm.isImageUrl(e[d].value)?f.css("background","url("+e[d].value+")"):f.css("background",e[d].value);break;case"stroke":f.css("background",e[d].value);break;case"image":f.css("background","url("+e[d].value+") no-repeat center center");break;case"r":jvm.$("<div/>").css({"border-radius":e[d].value,border:this.map.params.markerStyle.initial["stroke-width"]+"px "+this.map.params.markerStyle.initial.stroke+" solid",width:2*e[d].value+"px",height:2*e[d].value+"px",background:this.map.params.markerStyle.initial.fill}).appendTo(f)}c.append(f),b=e[d].label,this.params.labelRender&&(b=this.params.labelRender(b)),c.append(jvm.$("<div>"+b+" </div>").addClass("jvectormap-legend-tick-text")),a.append(c)}a.append(jvm.$("<div/>").css("clear","both"))},jvm.DataSeries=function(d,b,c){var a;d=d||{},d.attribute=d.attribute||"fill",this.elements=b,this.params=d,this.map=c,d.attributes&&this.setAttributes(d.attributes),jvm.$.isArray(d.scale)?(a="fill"===d.attribute||"stroke"===d.attribute?jvm.ColorScale:jvm.NumericScale,this.scale=new a(d.scale,d.normalizeFunction,d.min,d.max)):this.scale=d.scale?new jvm.OrdinalScale(d.scale):new jvm.SimpleScale(d.scale),this.values=d.values||{},this.setValues(this.values),this.params.legend&&(this.legend=new jvm.Legend($.extend({map:this.map,series:this},this.params.legend)))},jvm.DataSeries.prototype={setAttributes:function(c,a){var d,b=c;if("string"==typeof c){this.elements[c]&&this.elements[c].setStyle(this.params.attribute,a)}else{for(d in b){this.elements[d]&&this.elements[d].element.setStyle(this.params.attribute,b[d])}}},setValues:function(b){var e,f,a=-Number.MAX_VALUE,d=Number.MAX_VALUE,c={};if(this.scale instanceof jvm.OrdinalScale||this.scale instanceof jvm.SimpleScale){for(f in b){c[f]=b[f]?this.scale.getValue(b[f]):this.elements[f].element.style.initial[this.params.attribute]}}else{if("undefined"==typeof this.params.min||"undefined"==typeof this.params.max){for(f in b){e=parseFloat(b[f]),e>a&&(a=e),d>e&&(d=e)}}"undefined"==typeof this.params.min?(this.scale.setMin(d),this.params.min=d):this.scale.setMin(this.params.min),"undefined"==typeof this.params.max?(this.scale.setMax(a),this.params.max=a):this.scale.setMax(this.params.max);for(f in b){"indexOf"!=f&&(e=parseFloat(b[f]),c[f]=isNaN(e)?this.elements[f].element.style.initial[this.params.attribute]:this.scale.getValue(e))}}this.setAttributes(c),jvm.$.extend(this.values,b)},clear:function(){var b,a={};for(b in this.values){this.elements[b]&&(a[b]=this.elements[b].element.shape.style.initial[this.params.attribute])}this.setAttributes(a),this.values={}},setScale:function(a){this.scale.setScale(a),this.values&&this.setValues(this.values)},setNormalizeFunction:function(a){this.scale.setNormalizeFunction(a),this.values&&this.setValues(this.values)}},jvm.Proj={degRad:180/Math.PI,radDeg:Math.PI/180,radius:6381372,sgn:function(a){return a>0?1:0>a?-1:a},mill:function(b,a,d){return{x:this.radius*(a-d)*this.radDeg,y:-this.radius*Math.log(Math.tan((45+0.4*b)*this.radDeg))/0.8}},mill_inv:function(a,d,b){return{lat:(2.5*Math.atan(Math.exp(0.8*d/this.radius))-5*Math.PI/8)*this.degRad,lng:(b*this.radDeg+a/this.radius)*this.degRad}},merc:function(b,a,d){return{x:this.radius*(a-d)*this.radDeg,y:-this.radius*Math.log(Math.tan(Math.PI/4+b*Math.PI/360))}},merc_inv:function(a,d,b){return{lat:(2*Math.atan(Math.exp(d/this.radius))-Math.PI/2)*this.degRad,lng:(b*this.radDeg+a/this.radius)*this.degRad}},aea:function(m,o,l){var k=0,d=l*this.radDeg,i=29.5*this.radDeg,g=45.5*this.radDeg,p=m*this.radDeg,j=o*this.radDeg,f=(Math.sin(i)+Math.sin(g))/2,b=Math.cos(i)*Math.cos(i)+2*f*Math.sin(i),e=f*(j-d),h=Math.sqrt(b-2*f*Math.sin(p))/f,a=Math.sqrt(b-2*f*Math.sin(k))/f;return{x:h*Math.sin(e)*this.radius,y:-(a-h*Math.cos(e))*this.radius}},aea_inv:function(e,h,m){var p=e/this.radius,o=h/this.radius,l=0,d=m*this.radDeg,k=29.5*this.radDeg,i=45.5*this.radDeg,g=(Math.sin(k)+Math.sin(i))/2,b=Math.cos(k)*Math.cos(k)+2*g*Math.sin(k),a=Math.sqrt(b-2*g*Math.sin(l))/g,j=Math.sqrt(p*p+(a-o)*(a-o)),f=Math.atan(p/(a-o));return{lat:Math.asin((b-j*j*g*g)/(2*g))*this.degRad,lng:(d+f/g)*this.degRad}},lcc:function(k,l,j){var h=0,b=j*this.radDeg,i=l*this.radDeg,g=33*this.radDeg,e=45*this.radDeg,o=k*this.radDeg,d=Math.log(Math.cos(g)*(1/Math.cos(e)))/Math.log(Math.tan(Math.PI/4+e/2)*(1/Math.tan(Math.PI/4+g/2))),m=Math.cos(g)*Math.pow(Math.tan(Math.PI/4+g/2),d)/d,f=m*Math.pow(1/Math.tan(Math.PI/4+o/2),d),a=m*Math.pow(1/Math.tan(Math.PI/4+h/2),d);return{x:f*Math.sin(d*(i-b))*this.radius,y:-(a-f*Math.cos(d*(i-b)))*this.radius}},lcc_inv:function(d,g,l){var o=d/this.radius,m=g/this.radius,k=0,b=l*this.radDeg,j=33*this.radDeg,h=45*this.radDeg,f=Math.log(Math.cos(j)*(1/Math.cos(h)))/Math.log(Math.tan(Math.PI/4+h/2)*(1/Math.tan(Math.PI/4+j/2))),p=Math.cos(j)*Math.pow(Math.tan(Math.PI/4+j/2),f)/f,a=p*Math.pow(1/Math.tan(Math.PI/4+k/2),f),i=this.sgn(f)*Math.sqrt(o*o+(a-m)*(a-m)),e=Math.atan(o/(a-m));return{lat:(2*Math.atan(Math.pow(p/i,1/f))-Math.PI/2)*this.degRad,lng:(b+e/f)*this.degRad}}},jvm.MapObject=function(){},jvm.MapObject.prototype.getLabelText=function(a){var b;return b=this.config.label?"function"==typeof this.config.label.render?this.config.label.render(a):a:null},jvm.MapObject.prototype.getLabelOffsets=function(a){var b;return this.config.label&&("function"==typeof this.config.label.offsets?b=this.config.label.offsets(a):"object"==typeof this.config.label.offsets&&(b=this.config.label.offsets[a])),b||[0,0]},jvm.MapObject.prototype.setHovered=function(a){this.isHovered!==a&&(this.isHovered=a,this.shape.isHovered=a,this.shape.updateStyle(),this.label&&(this.label.isHovered=a,this.label.updateStyle()))},jvm.MapObject.prototype.setSelected=function(a){this.isSelected!==a&&(this.isSelected=a,this.shape.isSelected=a,this.shape.updateStyle(),this.label&&(this.label.isSelected=a,this.label.updateStyle()),jvm.$(this.shape).trigger("selected",[a]))},jvm.MapObject.prototype.setStyle=function(){this.shape.setStyle.apply(this.shape,arguments)},jvm.MapObject.prototype.remove=function(){this.shape.remove(),this.label&&this.label.remove()},jvm.Region=function(a){var d,c,b;this.config=a,this.map=this.config.map,this.shape=a.canvas.addPath({d:a.path,"data-code":a.code},a.style,a.canvas.rootElement),this.shape.addClass("jvectormap-region jvectormap-element"),d=this.shape.getBBox(),c=this.getLabelText(a.code),this.config.label&&c&&(b=this.getLabelOffsets(a.code),this.labelX=d.x+d.width/2+b[0],this.labelY=d.y+d.height/2+b[1],this.label=a.canvas.addText({text:c,"text-anchor":"middle","alignment-baseline":"central",x:this.labelX,y:this.labelY,"data-code":a.code},a.labelStyle,a.labelsGroup),this.label.addClass("jvectormap-region jvectormap-element"))},jvm.inherits(jvm.Region,jvm.MapObject),jvm.Region.prototype.updateLabelPosition=function(){this.label&&this.label.set({x:this.labelX*this.map.scale+this.map.transX*this.map.scale,y:this.labelY*this.map.scale+this.map.transY*this.map.scale})},jvm.Marker=function(a){var b;this.config=a,this.map=this.config.map,this.isImage=!!this.config.style.initial.image,this.createShape(),b=this.getLabelText(a.index),this.config.label&&b&&(this.offsets=this.getLabelOffsets(a.index),this.labelX=a.cx/this.map.scale-this.map.transX,this.labelY=a.cy/this.map.scale-this.map.transY,this.label=a.canvas.addText({text:b,"data-index":a.index,dy:"0.6ex",x:this.labelX,y:this.labelY},a.labelStyle,a.labelsGroup),this.label.addClass("jvectormap-marker jvectormap-element"))},jvm.inherits(jvm.Marker,jvm.MapObject),jvm.Marker.prototype.createShape=function(){var a=this;this.shape&&this.shape.remove(),this.shape=this.config.canvas[this.isImage?"addImage":"addCircle"]({"data-index":this.config.index,cx:this.config.cx,cy:this.config.cy},this.config.style,this.config.group),this.shape.addClass("jvectormap-marker jvectormap-element"),this.isImage&&jvm.$(this.shape.node).on("imageloaded",function(){a.updateLabelPosition()})},jvm.Marker.prototype.updateLabelPosition=function(){this.label&&this.label.set({x:this.labelX*this.map.scale+this.offsets[0]+this.map.transX*this.map.scale+5+(this.isImage?(this.shape.width||0)/2:this.shape.properties.r),y:this.labelY*this.map.scale+this.map.transY*this.map.scale+this.offsets[1]})},jvm.Marker.prototype.setStyle=function(a){var b;jvm.Marker.parentClass.prototype.setStyle.apply(this,arguments),"r"===a&&this.updateLabelPosition(),b=!!this.shape.get("image"),b!=this.isImage&&(this.isImage=b,this.config.style=jvm.$.extend(!0,{},this.shape.style),this.createShape())},jvm.Map=function(c){var b,a=this;if(this.params=jvm.$.extend(!0,{},jvm.Map.defaultParams,c),!jvm.Map.maps[this.params.map]){throw new Error("Attempt to use map which was not loaded: "+this.params.map)}this.mapData=jvm.Map.maps[this.params.map],this.markers={},this.regions={},this.regionsColors={},this.regionsData={},this.container=jvm.$("<div>").addClass("jvectormap-container"),this.params.container&&this.params.container.append(this.container),this.container.data("mapObject",this),this.defaultWidth=this.mapData.width,this.defaultHeight=this.mapData.height,this.setBackgroundColor(this.params.backgroundColor),this.onResize=function(){a.updateSize()},jvm.$(window).resize(this.onResize);for(b in jvm.Map.apiEvents){this.params[b]&&this.container.bind(jvm.Map.apiEvents[b]+".jvectormap",this.params[b])}this.canvas=new jvm.VectorCanvas(this.container[0],this.width,this.height),this.params.bindTouchEvents&&("ontouchstart" in window||window.DocumentTouch&&document instanceof DocumentTouch?this.bindContainerTouchEvents():window.MSGesture&&this.bindContainerPointerEvents()),this.bindContainerEvents(),this.bindElementEvents(),this.createTip(),this.params.zoomButtons&&this.bindZoomButtons(),this.createRegions(),this.createMarkers(this.params.markers||{}),this.updateSize(),this.params.focusOn&&("string"==typeof this.params.focusOn?this.params.focusOn={region:this.params.focusOn}:jvm.$.isArray(this.params.focusOn)&&(this.params.focusOn={regions:this.params.focusOn}),this.setFocus(this.params.focusOn)),this.params.selectedRegions&&this.setSelectedRegions(this.params.selectedRegions),this.params.selectedMarkers&&this.setSelectedMarkers(this.params.selectedMarkers),this.legendCntHorizontal=jvm.$("<div/>").addClass("jvectormap-legend-cnt jvectormap-legend-cnt-h"),this.legendCntVertical=jvm.$("<div/>").addClass("jvectormap-legend-cnt jvectormap-legend-cnt-v"),this.container.append(this.legendCntHorizontal),this.container.append(this.legendCntVertical),this.params.series&&this.createSeries()},jvm.Map.prototype={transX:0,transY:0,scale:1,baseTransX:0,baseTransY:0,baseScale:1,width:0,height:0,setBackgroundColor:function(a){this.container.css("background-color",a)},resize:function(){var a=this.baseScale;this.width/this.height>this.defaultWidth/this.defaultHeight?(this.baseScale=this.height/this.defaultHeight,this.baseTransX=Math.abs(this.width-this.defaultWidth*this.baseScale)/(2*this.baseScale)):(this.baseScale=this.width/this.defaultWidth,this.baseTransY=Math.abs(this.height-this.defaultHeight*this.baseScale)/(2*this.baseScale)),this.scale*=this.baseScale/a,this.transX*=this.baseScale/a,this.transY*=this.baseScale/a},updateSize:function(){this.width=this.container.width(),this.height=this.container.height(),this.resize(),this.canvas.setSize(this.width,this.height),this.applyTransform()},reset:function(){var b,a;for(b in this.series){for(a=0;a<this.series[b].length;a++){this.series[b][a].clear()}}this.scale=this.baseScale,this.transX=this.baseTransX,this.transY=this.baseTransY,this.applyTransform()},applyTransform:function(){var c,b,a,d;this.defaultWidth*this.scale<=this.width?(c=(this.width-this.defaultWidth*this.scale)/(2*this.scale),a=(this.width-this.defaultWidth*this.scale)/(2*this.scale)):(c=0,a=(this.width-this.defaultWidth*this.scale)/this.scale),this.defaultHeight*this.scale<=this.height?(b=(this.height-this.defaultHeight*this.scale)/(2*this.scale),d=(this.height-this.defaultHeight*this.scale)/(2*this.scale)):(b=0,d=(this.height-this.defaultHeight*this.scale)/this.scale),this.transY>b?this.transY=b:this.transY<d&&(this.transY=d),this.transX>c?this.transX=c:this.transX<a&&(this.transX=a),this.canvas.applyTransformParams(this.scale,this.transX,this.transY),this.markers&&this.repositionMarkers(),this.repositionLabels(),this.container.trigger("viewportChange",[this.scale/this.baseScale,this.transX,this.transY])},bindContainerEvents:function(){var c,b,a=!1,d=this;this.params.panOnDrag&&(this.container.mousemove(function(f){return a&&(d.transX-=(c-f.pageX)/d.scale,d.transY-=(b-f.pageY)/d.scale,d.applyTransform(),c=f.pageX,b=f.pageY),!1}).mousedown(function(f){return a=!0,c=f.pageX,b=f.pageY,!1}),this.onContainerMouseUp=function(){a=!1},jvm.$("body").mouseup(this.onContainerMouseUp)),this.params.zoomOnScroll&&this.container.mousewheel(function(f){var i=jvm.$(d.container).offset(),h=f.pageX-i.left,g=f.pageY-i.top,e=Math.pow(1+d.params.zoomOnScrollSpeed/1000,f.deltaFactor*f.deltaY);d.tip.css({transform:"none",opacity:0}),d.setScale(d.scale*e,h,g),f.preventDefault()})},bindContainerTouchEvents:function(){var b,e,i,h,d,c,g,a=this,f=function(m){var o,n,k,j,l=m.originalEvent.touches;"touchstart"==m.type&&(g=0),1==l.length?(1==g&&(k=a.transX,j=a.transY,a.transX-=(i-l[0].pageX)/a.scale,a.transY-=(h-l[0].pageY)/a.scale,a.applyTransform(),a.tip.css({transform:"none",opacity:0}),(k!=a.transX||j!=a.transY)&&m.preventDefault()),i=l[0].pageX,h=l[0].pageY):2==l.length&&(2==g?(n=Math.sqrt(Math.pow(l[0].pageX-l[1].pageX,2)+Math.pow(l[0].pageY-l[1].pageY,2))/e,a.setScale(b*n,d,c),a.tip.css({transform:"none",opacity:0}),m.preventDefault()):(o=jvm.$(a.container).offset(),d=l[0].pageX>l[1].pageX?l[1].pageX+(l[0].pageX-l[1].pageX)/2:l[0].pageX+(l[1].pageX-l[0].pageX)/2,c=l[0].pageY>l[1].pageY?l[1].pageY+(l[0].pageY-l[1].pageY)/2:l[0].pageY+(l[1].pageY-l[0].pageY)/2,d-=o.left,c-=o.top,b=a.scale,e=Math.sqrt(Math.pow(l[0].pageX-l[1].pageX,2)+Math.pow(l[0].pageY-l[1].pageY,2)))),g=l.length};jvm.$(this.container).bind("touchstart",f),jvm.$(this.container).bind("touchmove",f)},bindContainerPointerEvents:function(){var e=this,c=new MSGesture,b=this.container[0],d=function(f){c.addPointer(f.pointerId)},a=function(h){var g,f;(0!=h.translationX||0!=h.translationY)&&(g=e.transX,f=e.transY,e.transX+=h.translationX/e.scale,e.transY+=h.translationY/e.scale,e.applyTransform(),e.tip.css({transform:"none",opacity:0}),(g!=e.transX||f!=e.transY)&&h.preventDefault()),1!=h.scale&&(e.setScale(e.scale*h.scale,h.offsetX,h.offsetY),e.tip.css({transform:"none",opacity:0}),h.preventDefault())};c.target=b,b.addEventListener("MSGestureChange",a,!1),b.addEventListener("pointerdown",d,!1)},bindElementEvents:function(){var b,a,d,c=this;this.container.mousemove(function(f){Math.abs(b-f.pageX)+Math.abs(a-f.pageY)>2&&(d=!0)}),this.container.delegate("[class~='jvectormap-element']","mouseover mouseout",function(l){var g=jvm.$(this).attr("class").baseVal||jvm.$(this).attr("class"),i=-1===g.indexOf("jvectormap-region")?"marker":"region",j=jvm.$(this).attr("region"==i?"data-code":"data-index"),h="region"==i?c.regions[j].element:c.markers[j].element,f="region"==i?c.mapData.paths[j].name:c.markers[j].config.name||"",k=jvm.$.Event(i+"TipShow.jvectormap"),m=jvm.$.Event(i+"Over.jvectormap");"mouseover"==l.type?(c.container.trigger(m,[j]),m.isDefaultPrevented()||h.setHovered(!0),c.tip.text(f),c.container.trigger(k,[c.tip,j]),k.isDefaultPrevented()||(c.tip.css({transform:"translateY(-10px)",opacity:1}),c.tipWidth=c.tip.width(),c.tipHeight=c.tip.height())):(h.setHovered(!1),c.tip.css({transform:"none",opacity:0}),c.container.trigger(i+"Out.jvectormap",[j]))}),this.container.delegate("[class~='jvectormap-element']","mousedown",function(f){b=f.pageX,a=f.pageY,d=!1}),this.container.delegate("[class~='jvectormap-element']","mouseup",function(){var f=jvm.$(this).attr("class").baseVal?jvm.$(this).attr("class").baseVal:jvm.$(this).attr("class"),h=-1===f.indexOf("jvectormap-region")?"marker":"region",i=jvm.$(this).attr("region"==h?"data-code":"data-index"),e=jvm.$.Event(h+"Click.jvectormap"),g="region"==h?c.regions[i].element:c.markers[i].element;d||(c.container.trigger(e,[i]),("region"===h&&c.params.regionsSelectable||"marker"===h&&c.params.markersSelectable)&&(e.isDefaultPrevented()||(c.params[h+"sSelectableOne"]&&c.clearSelected(h+"s"),g.setSelected(!g.isSelected))))})},bindZoomButtons:function(){var a=this;jvm.$("<div/>").addClass("jvectormap-zoomin").text("+").appendTo(this.container),jvm.$("<div/>").addClass("jvectormap-zoomout").html("&#x2212;").appendTo(this.container),this.container.find(".jvectormap-zoomin").click(function(){a.setScale(a.scale*a.params.zoomStep,a.width/2,a.height/2,!1,a.params.zoomAnimate)}),this.container.find(".jvectormap-zoomout").click(function(){a.setScale(a.scale/a.params.zoomStep,a.width/2,a.height/2,!1,a.params.zoomAnimate)})},createTip:function(){var a=this;this.tip=jvm.$("<div/>").addClass("jvectormap-tip").appendTo(jvm.$("body")),this.container.mousemove(function(d){var c=d.pageX-13-(a.tipWidth/2),b=d.pageY-20-a.tipHeight;5>c&&(c=d.pageX+15),5>b&&(b=d.pageY+15),a.tip.css({left:c,top:b})})},setScale:function(s,c,a,m,f){var q,l,p,e,g,j,r,d,b,n=jvm.$.Event("zoom.jvectormap"),k=this,o=0,h=Math.abs(Math.round(60*(s-this.scale)/Math.max(s,this.scale))),t=new jvm.$.Deferred;return s>this.params.zoomMax*this.baseScale?s=this.params.zoomMax*this.baseScale:s<this.params.zoomMin*this.baseScale&&(s=this.params.zoomMin*this.baseScale),"undefined"!=typeof c&&"undefined"!=typeof a&&(zoomStep=s/this.scale,m?(d=c+this.defaultWidth*(this.width/(this.defaultWidth*s))/2,b=a+this.defaultHeight*(this.height/(this.defaultHeight*s))/2):(d=this.transX-(zoomStep-1)/s*c,b=this.transY-(zoomStep-1)/s*a)),f&&h>0?(l=this.scale,p=(s-l)/h,e=this.transX*this.scale,j=this.transY*this.scale,g=(d*s-e)/h,r=(b*s-j)/h,q=setInterval(function(){o+=1,k.scale=l+p*o,k.transX=(e+g*o)/k.scale,k.transY=(j+r*o)/k.scale,k.applyTransform(),o==h&&(clearInterval(q),k.container.trigger(n,[s/k.baseScale]),t.resolve())},10)):(this.transX=d,this.transY=b,this.scale=s,this.applyTransform(),this.container.trigger(n,[s/this.baseScale]),t.resolve()),t},setFocus:function(d){var g,c,f,b,e,a;if(d=d||{},d.region?b=[d.region]:d.regions&&(b=d.regions),b){for(e=0;e<b.length;e++){this.regions[b[e]]&&(c=this.regions[b[e]].element.shape.getBBox(),c&&("undefined"==typeof g?g=c:(f={x:Math.min(g.x,c.x),y:Math.min(g.y,c.y),width:Math.max(g.x+g.width,c.x+c.width)-Math.min(g.x,c.x),height:Math.max(g.y+g.height,c.y+c.height)-Math.min(g.y,c.y)},g=f)))}return this.setScale(Math.min(this.width/g.width,this.height/g.height),-(g.x+g.width/2),-(g.y+g.height/2),!0,d.animate)}return d.lat&&d.lng?(a=this.latLngToPoint(d.lat,d.lng),d.x=this.transX-a.x/this.scale,d.y=this.transY-a.y/this.scale):d.x&&d.y&&(d.x*=-this.defaultWidth,d.y*=-this.defaultHeight),this.setScale(d.scale*this.baseScale,d.x,d.y,!0,d.animate)},getSelected:function(c){var a,b=[];for(a in this[c]){this[c][a].element.isSelected&&b.push(a)}return b},getSelectedRegions:function(){return this.getSelected("regions")},getSelectedMarkers:function(){return this.getSelected("markers")},setSelected:function(b,c){var a;if("object"!=typeof c&&(c=[c]),jvm.$.isArray(c)){for(a=0;a<c.length;a++){this[b][c[a]].element.setSelected(!0)}}else{for(a in c){this[b][a].element.setSelected(!!c[a])}}},setSelectedRegions:function(a){this.setSelected("regions",a)},setSelectedMarkers:function(a){this.setSelected("markers",a)},clearSelected:function(d){var b,a={},c=this.getSelected(d);for(b=0;b<c.length;b++){a[c[b]]=!1}this.setSelected(d,a)},clearSelectedRegions:function(){this.clearSelected("regions")},clearSelectedMarkers:function(){this.clearSelected("markers")},getMapObject:function(){return this},getRegionName:function(a){return this.mapData.paths[a].name},createRegions:function(){var a,c,b=this;this.regionLabelsGroup=this.regionLabelsGroup||this.canvas.addGroup();for(a in this.mapData.paths){c=new jvm.Region({map:this,path:this.mapData.paths[a].path,code:a,style:jvm.$.extend(!0,{},this.params.regionStyle),labelStyle:jvm.$.extend(!0,{},this.params.regionLabelStyle),canvas:this.canvas,labelsGroup:this.regionLabelsGroup,label:"vml"!=this.canvas.mode?this.params.labels&&this.params.labels.regions:null}),jvm.$(c.shape).bind("selected",function(f,d){b.container.trigger("regionSelected.jvectormap",[jvm.$(this.node).attr("data-code"),d,b.getSelectedRegions()])}),this.regions[a]={element:c,config:this.mapData.paths[a]}}},createMarkers:function(g){var d,c,b,f,a,e=this;if(this.markersGroup=this.markersGroup||this.canvas.addGroup(),this.markerLabelsGroup=this.markerLabelsGroup||this.canvas.addGroup(),jvm.$.isArray(g)){for(a=g.slice(),g={},d=0;d<a.length;d++){g[d]=a[d]}}for(d in g){f=g[d] instanceof Array?{latLng:g[d]}:g[d],b=this.getMarkerPosition(f),b!==!1&&(c=new jvm.Marker({map:this,style:jvm.$.extend(!0,{},this.params.markerStyle,{initial:f.style||{}}),labelStyle:jvm.$.extend(!0,{},this.params.markerLabelStyle),index:d,cx:b.x,cy:b.y,group:this.markersGroup,canvas:this.canvas,labelsGroup:this.markerLabelsGroup,label:"vml"!=this.canvas.mode?this.params.labels&&this.params.labels.markers:null}),jvm.$(c.shape).bind("selected",function(i,h){e.container.trigger("markerSelected.jvectormap",[jvm.$(this.node).attr("data-index"),h,e.getSelectedMarkers()])}),this.markers[d]&&this.removeMarkers([d]),this.markers[d]={element:c,config:f})}},repositionMarkers:function(){var b,a;for(b in this.markers){a=this.getMarkerPosition(this.markers[b].config),a!==!1&&this.markers[b].element.setStyle({cx:a.x,cy:a.y})}},repositionLabels:function(){var a;for(a in this.regions){this.regions[a].element.updateLabelPosition()}for(a in this.markers){this.markers[a].element.updateLabelPosition()}},getMarkerPosition:function(a){return jvm.Map.maps[this.params.map].projection?this.latLngToPoint.apply(this,a.latLng||[0,0]):{x:a.coords[0]*this.scale+this.transX*this.scale,y:a.coords[1]*this.scale+this.transY*this.scale}},addMarker:function(e,a,d){var b,c,g={},f=[],d=d||[];for(g[e]=a,c=0;c<d.length;c++){b={},"undefined"!=typeof d[c]&&(b[e]=d[c]),f.push(b)}this.addMarkers(g,f)},addMarkers:function(c,b){var a;for(b=b||[],this.createMarkers(c),a=0;a<b.length;a++){this.series.markers[a].setValues(b[a]||{})}},removeMarkers:function(b){var a;for(a=0;a<b.length;a++){this.markers[b[a]].element.remove(),delete this.markers[b[a]]}},removeAllMarkers:function(){var a,b=[];for(a in this.markers){b.push(a)}this.removeMarkers(b)},latLngToPoint:function(f,c){var a,b,g,d=jvm.Map.maps[this.params.map].projection,e=d.centralMeridian;return -180+e>c&&(c+=360),a=jvm.Proj[d.type](f,c,e),b=this.getInsetForPoint(a.x,a.y),b?(g=b.bbox,a.x=(a.x-g[0].x)/(g[1].x-g[0].x)*b.width*this.scale,a.y=(a.y-g[0].y)/(g[1].y-g[0].y)*b.height*this.scale,{x:a.x+this.transX*this.scale+b.left*this.scale,y:a.y+this.transY*this.scale+b.top*this.scale}):!1},pointToLatLng:function(h,g){var d,k,j,f,e,b=jvm.Map.maps[this.params.map].projection,c=b.centralMeridian,a=jvm.Map.maps[this.params.map].insets;for(d=0;d<a.length;d++){if(k=a[d],j=k.bbox,f=h-(this.transX*this.scale+k.left*this.scale),e=g-(this.transY*this.scale+k.top*this.scale),f=f/(k.width*this.scale)*(j[1].x-j[0].x)+j[0].x,e=e/(k.height*this.scale)*(j[1].y-j[0].y)+j[0].y,f>j[0].x&&f<j[1].x&&e>j[0].y&&e<j[1].y){return jvm.Proj[b.type+"_inv"](f,-e,c)}}return !1},getInsetForPoint:function(a,e){var c,d,b=jvm.Map.maps[this.params.map].insets;for(c=0;c<b.length;c++){if(d=b[c].bbox,a>d[0].x&&a<d[1].x&&e>d[0].y&&e<d[1].y){return b[c]}}},createSeries:function(){var b,a;this.series={markers:[],regions:[]};for(a in this.params.series){for(b=0;b<this.params.series[a].length;b++){this.series[a][b]=new jvm.DataSeries(this.params.series[a][b],this[a],this)}}},remove:function(){this.tip.remove(),this.container.remove(),jvm.$(window).unbind("resize",this.onResize),jvm.$("body").unbind("mouseup",this.onContainerMouseUp)}},jvm.Map.maps={},jvm.Map.defaultParams={map:"world_mill_en",backgroundColor:"#505050",zoomButtons:!0,zoomOnScroll:!0,zoomOnScrollSpeed:3,panOnDrag:!0,zoomMax:8,zoomMin:1,zoomStep:1.6,zoomAnimate:!0,regionsSelectable:!1,markersSelectable:!1,bindTouchEvents:!0,regionStyle:{initial:{fill:"white","fill-opacity":1,stroke:"none","stroke-width":0,"stroke-opacity":1},hover:{"fill-opacity":0.8,cursor:"pointer"},selected:{fill:"yellow"},selectedHover:{}},regionLabelStyle:{initial:{"font-family":"Verdana","font-size":"12","font-weight":"bold",cursor:"default",fill:"black"},hover:{cursor:"pointer"}},markerStyle:{initial:{fill:"grey",stroke:"#505050","fill-opacity":1,"stroke-width":1,"stroke-opacity":1,r:5},hover:{stroke:"black","stroke-width":2,cursor:"pointer"},selected:{fill:"blue"},selectedHover:{}},markerLabelStyle:{initial:{"font-family":"Verdana","font-size":"12","font-weight":"bold",cursor:"default",fill:"black"},hover:{cursor:"pointer"}}},jvm.Map.apiEvents={onRegionTipShow:"regionTipShow",onRegionOver:"regionOver",onRegionOut:"regionOut",onRegionClick:"regionClick",onRegionSelected:"regionSelected",onMarkerTipShow:"markerTipShow",onMarkerOver:"markerOver",onMarkerOut:"markerOut",onMarkerClick:"markerClick",onMarkerSelected:"markerSelected",onViewportChange:"viewportChange"},jvm.MultiMap=function(b){var a=this;this.maps={},this.params=jvm.$.extend(!0,{},jvm.MultiMap.defaultParams,b),this.params.maxLevel=this.params.maxLevel||Number.MAX_VALUE,this.params.main=this.params.main||{},this.params.main.multiMapLevel=0,this.history=[this.addMap(this.params.main.map,this.params.main)],this.defaultProjection=this.history[0].mapData.projection.type,this.mapsLoaded={},this.params.container.css({position:"relative"}),this.backButton=jvm.$("<div/>").addClass("jvectormap-goback").text("Back").appendTo(this.params.container),this.backButton.hide(),this.backButton.click(function(){a.goBack()}),this.spinner=jvm.$("<div/>").addClass("jvectormap-spinner").appendTo(this.params.container),this.spinner.hide()},jvm.MultiMap.prototype={addMap:function(b,a){var c=jvm.$("<div/>").css({width:"100%",height:"100%"});return this.params.container.append(c),this.maps[b]=new jvm.Map(jvm.$.extend(a,{container:c})),this.params.maxLevel>a.multiMapLevel&&this.maps[b].container.on("regionClick.jvectormap",{scope:this},function(h,g){var d=h.data.scope,f=d.params.mapNameByCode(g,d);d.drillDownPromise&&"pending"===d.drillDownPromise.state()||d.drillDown(f,g)}),this.maps[b]},downloadMap:function(c){var b=this,a=jvm.$.Deferred();return this.mapsLoaded[c]?a.resolve():jvm.$.get(this.params.mapUrlByCode(c,this)).then(function(){b.mapsLoaded[c]=!0,a.resolve()},function(){a.reject()}),a},drillDown:function(b,e){var a=this.history[this.history.length-1],d=this,c=a.setFocus({region:e,animate:!0}),f=this.downloadMap(e);c.then(function(){"pending"===f.state()&&d.spinner.show()}),f.always(function(){d.spinner.hide()}),this.drillDownPromise=jvm.$.when(f,c),this.drillDownPromise.then(function(){a.params.container.hide(),d.maps[b]?d.maps[b].params.container.show():d.addMap(b,{map:b,multiMapLevel:a.params.multiMapLevel+1}),d.history.push(d.maps[b]),d.backButton.show()})},goBack:function(){var a=this.history.pop(),c=this.history[this.history.length-1],b=this;a.setFocus({scale:1,x:0.5,y:0.5,animate:!0}).then(function(){a.params.container.hide(),c.params.container.show(),c.updateSize(),1===b.history.length&&b.backButton.hide(),c.setFocus({scale:1,x:0.5,y:0.5,animate:!0})})}},jvm.MultiMap.defaultParams={mapNameByCode:function(a,b){return a.toLowerCase()+"_"+b.defaultProjection+"_en"},mapUrlByCode:function(a,b){return"jquery-jvectormap-data-"+a.toLowerCase()+"-"+b.defaultProjection+"-en.js"}};